#!/bin/bash
# install.sh - ุงุณฺฉุฑูพุช ูุตุจ ุฎูุฏฺฉุงุฑ ุฑุจุงุช

echo "๐ฆ ุฏุฑ ุญุงู ูุตุจ ุฑุจุงุช UserBot ูพุดุฑูุชู..."
echo "========================================"

# ุจุฑุฑุณ Python
if ! command -v python3 &> /dev/null; then
    echo "โ Python3 ุงูุช ูุดุฏ. ูุทูุงู ูุตุจ ฺฉูุฏ."
    exit 1
fi

# ุจุฑุฑุณ pip
if ! command -v pip3 &> /dev/null; then
    echo "โ pip3 ุงูุช ูุดุฏ. ูุทูุงู ูุตุจ ฺฉูุฏ."
    exit 1
fi

# ุงุฌุงุฏ ูพูุดูโูุง
echo "๐ ุงุฌุงุฏ ูพูุดูโูุง ูุงุฒู..."
mkdir -p data downloads logs sessions backups

# ฺฉูพ ูุงู ุชูุธูุงุช
if [ ! -f ".env" ]; then
    echo "โ๏ธ ุงุฌุงุฏ ูุงู .env..."
    cp .env.example .env
    echo "โ ูุงู .env ุงุฌุงุฏ ุดุฏ. ูุทูุงู ุงุทูุงุนุงุช ุฎูุฏ ุฑุง ุฏุฑ ุขู ูุงุฑุฏ ฺฉูุฏ."
fi

# ูุตุจ ูุงุจุณุชฺฏโูุง
echo "๐ฆ ุฏุฑ ุญุงู ูุตุจ ูุงุจุณุชฺฏโูุง Python..."
pip3 install -r requirements.txt

if [ $? -eq 0 ]; then
    echo "โ ูุงุจุณุชฺฏโูุง ุจุง ููููุช ูุตุจ ุดุฏูุฏ."
else
    echo "โ ุฎุทุง ุฏุฑ ูุตุจ ูุงุจุณุชฺฏโูุง."
    exit 1
fi

# ุงุฌุงุฏ ุฏุชุงุจุณ
echo "๐๏ธ ุงุฌุงุฏ ุฏุชุงุจุณ..."
python3 -c "
from database.models import DatabaseManager
db = DatabaseManager()
db.init_db()
print('โ ุฏุชุงุจุณ ุงุฌุงุฏ ุดุฏ.')
"

# ุฏุงุฏู ูุฌูุฒ ุจู ุงุณฺฉุฑูพุช
chmod +x start.sh
chmod +x restart.sh

echo ""
echo "๐ ูุตุจ ฺฉุงูู ุดุฏ!"
echo ""
echo "๐ ูุฑุงุญู ุจุนุฏ:"
echo "1. ูุงู .env ุฑุง ูุฑุงุด ฺฉูุฏ ู ุงุทูุงุนุงุช API ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ"
echo "2. ุฑุจุงุช ุฑุง ุจุง ุฏุณุชูุฑ ุฒุฑ ุงุฌุฑุง ฺฉูุฏ:"
echo "   ./start.sh"
echo ""
echo "๐ก ุจุฑุง ุฑุงูููุง ุจุดุชุฑ ูุงู README.md ุฑุง ูุทุงูุนู ฺฉูุฏ."
